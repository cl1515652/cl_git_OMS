<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hiaward.cl.oms.dao.TermMapper">
  <resultMap id="BaseResultMap" type="com.hiaward.cl.oms.entity.Term">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jul 27 13:36:53 CST 2016.
    -->
    <id column="termId" jdbcType="INTEGER" property="termid" />
    <result column="termNum" jdbcType="CHAR" property="termnum" />
    <result column="ipAddr" jdbcType="CHAR" property="ipaddr" />
    <result column="tellerNum" jdbcType="CHAR" property="tellernum" />
    <result column="termIndex" jdbcType="CHAR" property="termindex" />
    <result column="manufacturer" jdbcType="INTEGER" property="manufacturer" />
    <result column="deviceType" jdbcType="INTEGER" property="devicetype" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jul 27 13:36:53 CST 2016.
    -->
    termId, termNum, ipAddr, tellerNum, termIndex, manufacturer, deviceType
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jul 27 13:36:53 CST 2016.
    -->
    select 
    <include refid="Base_Column_List" />
    from term
    where termId = #{termid,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jul 27 13:36:53 CST 2016.
    -->
    delete from term
    where termId = #{termid,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.hiaward.cl.oms.entity.Term">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jul 27 13:36:53 CST 2016.
    -->
    insert into term (termId, termNum, ipAddr, 
      tellerNum, termIndex, manufacturer, 
      deviceType)
    values (#{termid,jdbcType=INTEGER}, #{termnum,jdbcType=CHAR}, #{ipaddr,jdbcType=CHAR}, 
      #{tellernum,jdbcType=CHAR}, #{termindex,jdbcType=CHAR}, #{manufacturer,jdbcType=INTEGER}, 
      #{devicetype,jdbcType=INTEGER})
  </insert>
  <insert id="insertSelective" parameterType="com.hiaward.cl.oms.entity.Term">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jul 27 13:36:53 CST 2016.
    -->
    insert into term
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="termid != null">
        termId,
      </if>
      <if test="termnum != null">
        termNum,
      </if>
      <if test="ipaddr != null">
        ipAddr,
      </if>
      <if test="tellernum != null">
        tellerNum,
      </if>
      <if test="termindex != null">
        termIndex,
      </if>
      <if test="manufacturer != null">
        manufacturer,
      </if>
      <if test="devicetype != null">
        deviceType,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="termid != null">
        #{termid,jdbcType=INTEGER},
      </if>
      <if test="termnum != null">
        #{termnum,jdbcType=CHAR},
      </if>
      <if test="ipaddr != null">
        #{ipaddr,jdbcType=CHAR},
      </if>
      <if test="tellernum != null">
        #{tellernum,jdbcType=CHAR},
      </if>
      <if test="termindex != null">
        #{termindex,jdbcType=CHAR},
      </if>
      <if test="manufacturer != null">
        #{manufacturer,jdbcType=INTEGER},
      </if>
      <if test="devicetype != null">
        #{devicetype,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.hiaward.cl.oms.entity.Term">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jul 27 13:36:53 CST 2016.
    -->
    update term
    <set>
      <if test="termnum != null">
        termNum = #{termnum,jdbcType=CHAR},
      </if>
      <if test="ipaddr != null">
        ipAddr = #{ipaddr,jdbcType=CHAR},
      </if>
      <if test="tellernum != null">
        tellerNum = #{tellernum,jdbcType=CHAR},
      </if>
      <if test="termindex != null">
        termIndex = #{termindex,jdbcType=CHAR},
      </if>
      <if test="manufacturer != null">
        manufacturer = #{manufacturer,jdbcType=INTEGER},
      </if>
      <if test="devicetype != null">
        deviceType = #{devicetype,jdbcType=INTEGER},
      </if>
    </set>
    where termId = #{termid,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.hiaward.cl.oms.entity.Term">
    update term
    set termNum = #{termnum,jdbcType=CHAR},
      ipAddr = #{ipaddr,jdbcType=CHAR},
      tellerNum = #{tellernum,jdbcType=CHAR},
      termIndex = #{termindex,jdbcType=CHAR},
      manufacturer = #{manufacturer,jdbcType=INTEGER},
      deviceType = #{devicetype,jdbcType=INTEGER}
    where termId = #{termid,jdbcType=INTEGER}
  </update>
  
  <select id="queryTerm" parameterType="HashMap" resultType="map">
    SELECT * FROM (
	SELECT t.*,s1.ZH_NAME Manufacturer_name , s2.ZH_NAME DeviceType_name
	FROM term t 
	LEFT JOIN sys_dict s1 ON (s1.SD_CODE = t.manufacturer AND s1.DT_TYPE = 'Manufacturer')
	LEFT JOIN sys_dict s2 ON (s2.SD_CODE = t.deviceType AND s2.DT_TYPE = 'DeviceType')
	) t where 1 = 1

       <if test="termNum!=null and termNum!='' ">     
          and t.termNum = #{termNum,jdbcType=CHAR}
       </if>
       <if test="ipAddr!=null and ipAddr!='' ">
          and ipAddr = #{ipAddr,jdbcType=CHAR}
       </if>
       <if test="manufacturer!=null and manufacturer!='' ">     
          and  manufacturer = #{manufacturer,jdbcType=CHAR}
       </if>
       <if test="deviceType!=null and deviceType!='' ">     
          and deviceType = #{deviceType,jdbcType=CHAR}
       </if>

  </select>
  
  <!-- 统计设备故障 -->
  <select id="queryErrorTerm" parameterType="HashMap" resultType="map">
		SELECT t.termId,t.termNum,t.ipAddr,t.size,t.sum_time,
		       s1.ZH_NAME Manufacturer_name,
		       s2.ZH_NAME DeviceType_name
		FROM
		  (SELECT t.termId,
		          t.termNum ,
		          t.ipAddr,
		          t.manufacturer,
		          t.deviceType,
		          t1.size,
		          t1.sum_time
		   FROM term t
		   LEFT JOIN
		     (SELECT term_id,
		             COUNT(term_id)SIZE, SUM(TIMESTAMPDIFF(SECOND,e.start_time,e.end_time))/60 sum_time
		      FROM error_info e
		      WHERE 1=1
		        AND (TIMESTAMPDIFF(SECOND,#{start_time,jdbcType=CHAR},e.start_time) > '0'
		             AND '0' > TIMESTAMPDIFF(SECOND,#{end_time,jdbcType=CHAR},e.end_time))
		      GROUP BY term_id) t1 ON t.termId = t1.term_id) t
		LEFT JOIN sys_dict s1 ON (s1.SD_CODE = t.manufacturer
		                          AND s1.DT_TYPE = 'Manufacturer')
		LEFT JOIN sys_dict s2 ON (s2.SD_CODE = t.deviceType
		                          AND s2.DT_TYPE = 'DeviceType')
  </select>
  
  <!-- 查询设备状态 -->
  <select id="queryTremStatus" parameterType="HashMap" resultType="map">
   SELECT * FROM (
	SELECT t.*,
	       s1.ZH_NAME Manufacturer_name,
	       s2.ZH_NAME DeviceType_name
	FROM
	  ( SELECT *
	   FROM term t
	   LEFT JOIN vmodule_status v ON t.termId = v.term_id ) t
	LEFT JOIN sys_dict s1 ON (s1.SD_CODE = t.manufacturer
	                          AND s1.DT_TYPE = 'Manufacturer')
	LEFT JOIN sys_dict s2 ON (s2.SD_CODE = t.deviceType
	                          AND s2.DT_TYPE = 'DeviceType')
	) t where 1 = 1

       <if test="termNum!=null and termNum!='' ">     
          and t.termNum = #{termNum,jdbcType=CHAR}
       </if>
       <if test="ipAddr!=null and ipAddr!='' ">
          and ipAddr = #{ipAddr,jdbcType=CHAR}
       </if>
       <if test="manufacturer!=null and manufacturer!='' ">     
          and  manufacturer = #{manufacturer,jdbcType=CHAR}
       </if>
       <if test="deviceType!=null and deviceType!='' ">     
          and deviceType = #{deviceType,jdbcType=CHAR}
       </if>
       <if test="v_status!=null and v_status!='' ">     
          and v_status = #{v_status,jdbcType=CHAR}
       </if>
	</select>
	
	<!-- 统计设备状态 -->
	<select id="getZcsb" parameterType="java.lang.String" resultType="string">
	   	SELECT COUNT(1) FROM term t LEFT JOIN vmodule_status v ON t.termId = v.term_id WHERE v.v_status = #{status,jdbcType=CHAR}
	</select>

 
  
</mapper>